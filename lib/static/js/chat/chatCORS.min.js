!function e(t,a,s){function n(r,o){if(!a[r]){if(!t[r]){var c="function"==typeof require&&require;if(!o&&c)return c(r,!0);if(i)return i(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var h=a[r]={exports:{}};t[r][0].call(h.exports,function(e){var a=t[r][1][e];return n(a||e)},h,h.exports,e,t,a,s)}return a[r].exports}for(var i="function"==typeof require&&require,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(require,module,exports){function getLastTextNodeIn(e){for(;e;){if(3==e.nodeType)return e;e=e.lastChild}}function isRangeAfterNode(e,t){var a,s;return e.compareBoundaryPoints?(a=document.createRange(),s=getLastTextNodeIn(t),a.selectNodeContents(s),a.collapse(!1),e.compareBoundaryPoints(e.START_TO_END,a)>-1):e.compareEndPoints?1==t.nodeType&&((a=document.body.createTextRange()).moveToElementText(t),a.collapse(!1),e.compareEndPoints("StartToEnd",a)>-1):void 0}var ChatMessage=React.createClass({displayName:"ChatMessage",render:function(){var e=this.props.message;return React.createElement("div",{className:[e.type,"message"].join(" "),title:e.ins},"in"==e.type?React.createElement("div",{className:"dleft"}):"",React.createElement("div",{className:"trueMessage"},React.createElement("div",{className:"messageDate"},e.ins),React.createElement("div",{className:"messageMessage"},e.message)),"out"==e.type?React.createElement("div",{className:"dright"}):"")}});Array.prototype.remByVal=function(e){for(var t=0;t<this.length;t++)this[t]===e&&(this.splice(t,1),t--);return this};var ChatList=React.createClass({displayName:"ChatList",render:function(){var e=this.props.messages.map(function(e){return React.createElement(ChatMessage,{message:e})});return React.createElement("div",{className:"rootChat",ref:e=>this.rootChat=e},e)}}),User=React.createClass({displayName:"User",getInitialState:function(){return{user:{}}},componentWillMount:function(){this.setState({user:this.props.user})},setIDchat:function(){},openChatViewer:function(e){this.props.onClick(this.props.id)},message:function(){alert("my message")},childContextTypes:{messsage:React.PropTypes.func},render:function(){var e=this.state.user,t=e.vc_Nombre+", "+e.vc_ApePaterno+" "+e.vc_ApeMaterno;return React.createElement("div",{className:"user",ref:"user",id:e.in_UsuarioID,onClick:this.openChatViewer.bind(this),title:t},React.createElement("div",{title:t},React.createElement("span",{className:"userAvatar"}," ",React.createElement("p",{className:e.avatar}," ",e.avatar," ")," "),React.createElement("span",{className:"userSpan",title:t},this.props.truncateString(t,28))))}}),BtnAll=React.createClass({displayName:"BtnAll",openChatViewer:function(e){this.props.onClick(this.props.id)},render:function(){return React.createElement("div",{className:"sendToAllWrapper"},React.createElement("span",{className:"sendToAll",onClick:this.openChatViewer.bind(this)}," ",React.createElement("p",null,"ENVIAR  "),React.createElement("p",null,"A "),React.createElement("p",null," TODOS")," "))}}),UserList=React.createClass({displayName:"UserList",statics:{setConnectedState:function(e){alert(e)}},getInitialState:function(){return{users:[],usersDict:{},allUsers:[]}},componentWillMount:function(){this.setState({users:this.props.users})},userClickHandler:function(e){this.props.onClick(e)},updateState:function(e,t){var a=[];a[t]=e,a=this.state.allUsers.concat(a)},componentDidMount:function(){},render:function(){var e=null,t=[],a=this.state.users.map(function(a){if(0!=a.in_UsuarioID){var s=React.createElement(User,{user:a,onClick:this.userClickHandler,key:a.in_UsuarioID,truncateString:this.props.owner.truncateString,id:a.in_UsuarioID,ref:e=>this.updateState(e,a.in_UsuarioID)});return t[a.in_UsuarioID]=s,s}e=[React.createElement(BtnAll,{onClick:this.userClickHandler,key:a.in_UsuarioID,id:a.in_UsuarioID})]},this);return React.createElement("div",null," ",e," ",React.createElement("div",{className:"userListWrapper"}," ",a," ")," ")}}),ChatViewer=React.createClass({displayName:"ChatViewer",statics:function(){alert("RUN!!!")},getInitialState:function(){return{id:null,userName:"",toggleHide:!0,messages:[],randomValue:Math.random(),contentEditable:React.createElement(ContentEditable,{key:Math.random(),onKeyDown:this.sendMessage,reizeChatHistory:this.resizeChatHistory})}},hideCurrentChat:function(e){this.setState({toggleHide:!this.state.toggleHide}),this.props.onDropChatViewer(this.state.id)},componentWillMount:function(){this.setState({id:this.props.id,messages:this.props.messages,userName:this.props.userName})},setContentEditable:function(){this.setState({contentEditable:React.createElement(ContentEditable,{key:Math.random(),onKeyDown:this.sendMessage,reizeChatHistory:this.resizeChatHistory})})},sendMessage:function(e){if("DIV"===e.target.nodeName)return this.props.onClick(e.target.textContent,this.state.id),void this.setContentEditable();"Enter"==e.key&&(e.target.value.trim().length>0&&this.props.onClick(e.target.value,this.state.id),e.target.value="")},scrollToBottom:function(e){var t=this.refs.chatHistory;t.scrollTop=t.scrollHeight-t.clientHeight},componentDidMount:function(){this.scrollToBottom()},componentDidUpdate:function(){this.scrollToBottom()},resizeChatHistory:function(){const e=ReactDOM.findDOMNode(this.refs.chatHistory);e.style.height=e.style.height-20;const t=ReactDOM.findDOMNode(this.refs.chatMessage);t.style.height=t.style.height+20},render:function(){var e=this.props.owner.truncateString(this.state.userName,28);return React.createElement("div",{className:["chatViewer",0!=this.state.id?"broadcast":""].join(" ")},React.createElement("div",{title:this.state.userName,className:["userUser",0==this.state.id?"broadcastUser":""].join(" ")},React.createElement("span",{className:"userName"},e)," ",React.createElement("span",{className:"closeChat",onClick:this.hideCurrentChat},"âœ–")),React.createElement("div",{className:"chatContainner"},React.createElement("div",{className:"chatHistory",ref:"chatHistory"},React.createElement(ChatList,{messages:this.state.messages})),React.createElement("div",{className:"chatMessage",ref:"chatMessage"},React.createElement("input",{type:"text",id:"txtMessage",placeholder:"Ingresar mensaje y presionar ENTER",onKeyPress:this.sendMessage}))))}}),ContentEditable=React.createClass({displayName:"ContentEditable",render:function(){return React.createElement("div",{className:"text-box",ref:"textBox",onKeyPress:this.myKeyPress,contentEditable:!0,placeholder:"Ingresar Mensaje y Presionar ENTER"})},myKeyPress:function(e){console.log(this.refs.textBox.clientHeight),this.refs.textBox.clientHeight>25&&this.props.reizeChatHistory(25),"Enter"==e.key&&(e.target.textContent.trim().length>0&&this.props.onKeyDown(e),e.target.innerHTML="")}}),MyComponent=React.createClass({displayName:"MyComponent",handleClick:function(){null!==this.myTextInput&&this.myTextInput.focus()},render:function(){return React.createElement("div",null,React.createElement("input",{type:"text",ref:e=>this.myTextInput=e}),React.createElement("input",{type:"button",value:"Focus the text input",onClick:this.handleClick}))}}),ChatContainer=React.createClass({displayName:"ChatContainer",getInitialState:function(){return{myProps:{},data:[],ws:null,domain:"",separator:"://",port:":xxPORTxx",protocol:"ws://",namespace:"/websocket",toggleHide:!0,toggleHideChatPanel:!1,step:1,messages:[],haveAdminPanel:!1,users:[],currentChats:[],chatViewers:[],chatViewersDict:{},hiddeToggleChatManager:!0,owner:this}},onMessage:function(e){var data=eval("("+e.data+")");this.on(data.event,data.data)},on:function(e,t){if("new chat"==e){if(-1===this.state.currentChats.indexOf(t.userIDDST))return void this.receiveUserAction(t.userIDDST);this.activateChatPanel();var a=Object.assign({},this.state),s=a.chatViewersDict[t.userIDDST].state.messages.concat(t);a.chatViewersDict[t.userIDDST].state.messages=s;var n=a.chatViewers.map(function(e){return e.props.id==t.userIDDST?React.createElement(ChatViewer,{id:t.userIDDST,key:t.userIDDST,onClick:this.sendMessage.bind(this),owner:this.state.owner,ref:e=>this.updateState(e,t.userIDDST),data:"rawData",messages:s,userName:"aux",onDropChatViewer:this.dropChatViewer}):e},this);a.chatViewers=n,this.setState(a)}else"only for admins"==e?this.state.haveAdminPanel||this.setState({haveAdminPanel:!0,users:t}):"populate chat-list"==e?this.setState({messages:t}):"chat for user"==e&&this.addChatViewer(t.messages,t.userIDDST)},emit:function(e,t){var a=JSON.stringify({0:e,1:t});this.state.ws.send(a)},onOpen:function(e,t){},notifier:function(){console.log("CLEAN websockets")},componentWillMount:function(){var e=this.state.ws;null!=e&&(e.removeEventListener("onopen",this.notifier),e.removeEventListener("onerror",this.notifier),e.removeEventListener("onclose",this.notifier));var t=new WebSocket("ws"+this.state.separator+document.domain+this.state.port+this.state.namespace);t.onmessage=this.onMessage,t.onopen=this.onOpen,t.onclose=this.onClose,t.onerror=this.onError,this.setState({ws:t})},reconnectSocket:function(e){that=this,setTimeout(function(){console.log("WebSocketClient: reconnecting..."),that.componentWillMount()},2e3)},onClose:function(e){this.reconnectSocket(e)},onError:function(e){this.reconnectSocket(e)},componentDidMount:function(){var e=Object.assign({},this.state);e.myProps.user="@daemonDEV",e.myProps.profile="root",this.setState(e)},updateState:function(e,t){var a=Object.assign({},this.state);a.chatViewersDict[t]=e,this.setState(a)},sendMessage:function(e,t){var a={name:this.state.myProps.user,message:e,userIDDST:t};this.emit("new message",a)},receiveUserAction:function(e){var t={userIDDST:e};this.emit("get chat for this user",t)},dropChatViewer:function(e){var t=Object.assign({},this.state),a=t.currentChats.filter(t=>t!=e);t.currentChats=a;var s=t.chatViewers.filter(t=>t.props.id!=e);t.chatViewers=s,0==s.length&&(t.hiddeToggleChatManager=!0),this.setState(t)},activateChatPanel(){this.setState({toggleHideChatPanel:!1})},addChatViewer:function(e,t){if(this.activateChatPanel(),-1===this.state.currentChats.indexOf(t)){var a="";this.state.users.map(function(e){e.in_UsuarioID==t&&(a=e.vc_Nombre+" "+e.vc_ApePaterno+" "+e.vc_ApeMaterno)},this);var s=this.state.chatViewers,n=null,i=this.state.currentChats;s.length>3&&(n=s.pop(),i=i.filter(e=>e!=n.props.id),console.log("deleting: "+n.props.id+" - length: "+s.length)),this.setState({chatViewers:[React.createElement(ChatViewer,{id:t,key:t,onClick:this.sendMessage.bind(this),ref:e=>this.updateState(e,t),owner:this.state.owner,data:"rawData",messages:e,userName:a,onDropChatViewer:this.dropChatViewer})].concat(s),hiddeToggleChatManager:!1,currentChats:i.concat(t)})}},scrollSmoothToBottom:function(e){document.getElementById(e)},hideAdminPanel:function(){this.setState({toggleHide:!this.state.toggleHide})},toggleChatPanel:function(e){this.setState({toggleHideChatPanel:!this.state.toggleHideChatPanel})},truncateString:function(e,t){if(e.length<t)return e;var a=e.slice(0,t),s=a.split(" "),n=s.length;return n>1&&s[n-1]!==e.split(" ")[n-1]&&(s.pop(),a=s.join(" ")),e.length>t?a+"...":a},render:function(){return React.createElement("div",{className:"chatMain"},React.createElement("div",{className:"hideAdminPanel",onClick:this.hideAdminPanel.bind(this)}," ",React.createElement("span",null," ",this.state.toggleHide?"MOSTRAR":"OCULTAR")," ",React.createElement("span",null,"PANEL")," "),React.createElement("div",{id:"divMiniPanel",className:this.state.hiddeToggleChatManager?"hiddden":"",onClick:this.toggleChatPanel.bind(this)}," ",React.createElement("div",{className:"togglePanelContainner"},React.createElement("span",{id:"spanToggleHeader",className:this.state.toggleHideChatPanel?"":"hiddden"}),React.createElement("span",{id:"spanToggleText"},this.state.toggleHideChatPanel?"MOSTRAR":"OCULTAR"," chat"),React.createElement("span",{id:"spanToggleFooter",className:this.state.toggleHideChatPanel?"hiddden":""}))," "),React.createElement("div",{id:"divChatPanel",ref:"myChatPanel",className:this.state.toggleHideChatPanel?"hiddden":""},this.state.chatViewers),this.state.haveAdminPanel?React.createElement("div",{id:"divAdminPanel",className:this.state.toggleHide?"hiddden":"",ref:"adminPanel"},React.createElement(UserList,{users:this.state.users,onClick:this.receiveUserAction,onHideAdminPanel:this.hideAdminPanel,owner:this.state.owner})):"")}}),Child=React.createClass({displayName:"Child",handleClick:function(){this.props.owner.setState({count:this.props.count+1})},render:function(){return React.createElement("div",{onClick:this.handleClick},this.props.count)}}),Parent=React.createClass({displayName:"Parent",getInitialState:function(){return{count:0,owner:this}},render:function(){return React.createElement(Child,React.__spread({},this.state))}});ReactDOM.render(React.createElement(ChatContainer,null),document.getElementById("divChatWrapper"))},{}]},{},[1]);