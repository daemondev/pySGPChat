!function e(t,a,s){function n(r,c){if(!a[r]){if(!t[r]){var o="function"==typeof require&&require;if(!c&&o)return o(r,!0);if(i)return i(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var h=a[r]={exports:{}};t[r][0].call(h.exports,function(e){var a=t[r][1][e];return n(a||e)},h,h.exports,e,t,a,s)}return a[r].exports}for(var i="function"==typeof require&&require,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(require,module,exports){function getLastTextNodeIn(e){for(;e;){if(3==e.nodeType)return e;e=e.lastChild}}function isRangeAfterNode(e,t){var a,s;return e.compareBoundaryPoints?(a=document.createRange(),s=getLastTextNodeIn(t),a.selectNodeContents(s),a.collapse(!1),e.compareBoundaryPoints(e.START_TO_END,a)>-1):e.compareEndPoints?1==t.nodeType&&((a=document.body.createTextRange()).moveToElementText(t),a.collapse(!1),e.compareEndPoints("StartToEnd",a)>-1):void 0}var ChatMessage=React.createClass({displayName:"ChatMessage",render:function(){var e=this.props.message;return React.createElement("div",{className:[e.type,"message"].join(" "),title:e.ins},"in"==e.type?React.createElement("div",{className:"dleft"}):"",React.createElement("div",{className:"trueMessage"},React.createElement("div",{className:"messageDate"},e.ins),React.createElement("div",{className:"messageMessage"},e.message)),"out"==e.type?React.createElement("div",{className:"dright"}):"")}});Array.prototype.remByVal=function(e){for(var t=0;t<this.length;t++)this[t]===e&&(this.splice(t,1),t--);return this};var ChatList=React.createClass({displayName:"ChatList",render:function(){var e=this.props.messages.map(function(e){return React.createElement(ChatMessage,{message:e})});return React.createElement("div",{className:"rootChat",ref:e=>this.rootChat=e},e)}}),User=React.createClass({displayName:"User",getInitialState:function(){return{user:{}}},componentWillMount:function(){this.setState({user:this.props.user})},setIDchat:function(){},openChatViewer:function(e){this.props.onClick(this.props.id)},render:function(){var e=this.state.user;return React.createElement("div",{className:"user",ref:"user",id:e.in_UsuarioID,onClick:this.openChatViewer.bind(this)},React.createElement("div",null,React.createElement("span",{className:"userAvatar"}," ",React.createElement("p",{className:e.avatar}," ",e.avatar," ")," "),React.createElement("span",{className:"userSpan"},e.vc_Nombre,", ",e.vc_ApePaterno," ",e.vc_ApeMaterno)))}}),BtnAll=React.createClass({displayName:"BtnAll",openChatViewer:function(e){this.props.onClick(this.props.id)},hideAdminPanel:function(){this.props.hideAdminPanel()},render:function(){return React.createElement("div",{className:"sendToAllWrapper"},React.createElement("span",{className:"sendToAll",onClick:this.openChatViewer.bind(this)}," ",React.createElement("p",null,"ENVIAR  "),React.createElement("p",null,"A "),React.createElement("p",null," TODOS")," "))}}),UserList=React.createClass({displayName:"UserList",statics:{setConnectedState:function(e){alert(e)}},getInitialState:function(){return{users:[],usersDict:{}}},componentWillMount:function(){this.setState({users:this.props.users})},userClickHandler:function(e){this.props.onClick(e)},hideAdminPanel:function(){this.props.onHideAdminPanel()},render:function(){var e=null,t=this.state.users.map(function(t){if(0!=t.in_UsuarioID)return React.createElement(User,{user:t,onClick:this.userClickHandler,key:t.in_UsuarioID,id:t.in_UsuarioID});e=[React.createElement(BtnAll,{onClick:this.userClickHandler,key:t.in_UsuarioID,id:t.in_UsuarioID,hideAdminPanel:this.hideAdminPanel})]},this);return React.createElement("div",null,"  ",e," ",React.createElement("div",{className:"userListWrapper"}," ",t," ")," ")}}),ChatViewer=React.createClass({displayName:"ChatViewer",statics:function(){alert("RUN!!!")},getInitialState:function(){return{id:null,userName:"",toggleHide:!0,messages:[],randomValue:Math.random(),contentEditable:React.createElement(ContentEditable,{key:Math.random(),onKeyDown:this.sendMessage,reizeChatHistory:this.resizeChatHistory})}},hideCurrentChat:function(e){this.setState({toggleHide:!this.state.toggleHide}),this.props.onDropChatViewer(this.state.id)},componentWillMount:function(){this.setState({id:this.props.id,messages:this.props.messages,userName:this.props.userName})},setContentEditable:function(){this.setState({contentEditable:React.createElement(ContentEditable,{key:Math.random(),onKeyDown:this.sendMessage,reizeChatHistory:this.resizeChatHistory})})},sendMessage:function(e){if("DIV"===e.target.nodeName)return this.props.onClick(e.target.textContent,this.state.id),void this.setContentEditable();"Enter"==e.key&&(e.target.value.trim().length>0&&this.props.onClick(e.target.value,this.state.id),e.target.value="")},scrollToBottom:function(e){var t=this.refs.chatHistory;t.scrollTop=t.scrollHeight-t.clientHeight},componentDidMount:function(){this.scrollToBottom()},componentDidUpdate:function(){this.scrollToBottom()},resizeChatHistory:function(){const e=ReactDOM.findDOMNode(this.refs.chatHistory);e.style.height=e.style.height-20;const t=ReactDOM.findDOMNode(this.refs.chatMessage);t.style.height=t.style.height+20},render:function(){return React.createElement("div",{className:["chatViewer",0!=this.state.id?"broadcast":""].join(" ")},React.createElement("div",{className:["userUser",0==this.state.id?"broadcastUser":""].join(" ")},React.createElement("span",{className:"userName"},this.state.userName)," ",React.createElement("span",{className:"closeChat",onClick:this.hideCurrentChat},"âœ–")),React.createElement("div",{className:"chatContainner"},React.createElement("div",{className:"chatHistory",ref:"chatHistory"},React.createElement(ChatList,{messages:this.state.messages})),React.createElement("div",{className:"chatMessage",ref:"chatMessage"},React.createElement(ContentEditable,{rnd:this.randomValue,ref:e=>this.theContentEditable=e,onKeyDown:this.sendMessage,reizeChatHistory:this.resizeChatHistory}))))}}),ContentEditable=React.createClass({displayName:"ContentEditable",render:function(){return React.createElement("div",{className:"text-box",ref:"textBox",onKeyPress:this.myKeyPress,contentEditable:!0,placeholder:"Ingresar Mensaje y Presionar ENTER"})},myKeyPress:function(e){console.log(this.refs.textBox.clientHeight),this.refs.textBox.clientHeight>25&&this.props.reizeChatHistory(25),"Enter"==e.key&&(e.target.textContent.trim().length>0&&this.props.onKeyDown(e),e.target.innerHTML="")}}),MyComponent=React.createClass({displayName:"MyComponent",handleClick:function(){null!==this.myTextInput&&this.myTextInput.focus()},render:function(){return React.createElement("div",null,React.createElement("input",{type:"text",ref:e=>this.myTextInput=e}),React.createElement("input",{type:"button",value:"Focus the text input",onClick:this.handleClick}))}}),AdminPanel=React.createClass({displayName:"AdminPanel",getInitialState:function(){return{users:[]}},render:function(){var e=this.props.users;return React.createElement("div",null,React.createElement("div",{className:"innerAdminPanel"},React.createElement("h1",null,"in Admin Panel"),React.createElement(UserList,{users:e})))}}),ChatContainer=React.createClass({displayName:"ChatContainer",getInitialState:function(){return{myProps:{},data:[],ws:null,domain:"",separator:"://",port:":8888",protocol:"ws://",namespace:"/websocket",toggleHide:!1,toggleHideChatPanel:!1,step:1,messages:[],haveAdminPanel:!1,users:[],currentChats:[],chatViewers:[],chatViewersDict:{}}},onMessage:function(e){var data=eval("("+e.data+")");this.on(data.event,data.data)},on:function(e,t){if("new chat"==e){if(-1===this.state.currentChats.indexOf(t.userIDDST))return void this.receiveUserAction(t.userIDDST);this.activateChatPanel();var a=Object.assign({},this.state),s=a.chatViewersDict[t.userIDDST].state.messages.concat(t);a.chatViewersDict[t.userIDDST].state.messages=s;var n=a.chatViewers.map(function(e){return e.props.id==t.userIDDST?React.createElement(ChatViewer,{id:t.userIDDST,key:t.userIDDST,onClick:this.sendMessage.bind(this),ref:e=>this.updateState(e,t.userIDDST),data:"rawData",messages:s,userName:"aux",onDropChatViewer:this.dropChatViewer}):e},this);a.chatViewers=n,this.setState(a)}else"only for admins"==e?this.state.haveAdminPanel||this.setState({haveAdminPanel:!0,users:t}):"populate chat-list"==e?this.setState({messages:t}):"chat for user"==e&&this.addChatViewer(t.messages,t.userIDDST)},emit:function(e,t){var a=JSON.stringify({0:e,1:t});this.state.ws.send(a)},onOpen:function(e,t){},componentWillMount:function(){var e=new WebSocket("ws"+this.state.separator+document.domain+this.state.port+this.state.namespace);e.onmessage=this.onMessage,e.onopen=this.onOpen,this.setState({ws:e})},componentDidMount:function(){var e=Object.assign({},this.state);e.myProps.user="@daemonDEV",e.myProps.profile="root",this.setState(e)},updateState:function(e,t){var a=Object.assign({},this.state);a.chatViewersDict[t]=e,this.setState(a)},sendMessage:function(e,t){var a={name:this.state.myProps.user,message:e,userIDDST:t};this.emit("new message",a)},receiveUserAction:function(e){var t={userIDDST:e};this.emit("get chat for this user",t)},dropChatViewer:function(e){var t=Object.assign({},this.state),a=t.currentChats.filter(t=>t!=e);t.currentChats=a;var s=t.chatViewers.filter(t=>t.props.id!=e);t.chatViewers=s,this.setState(t)},activateChatPanel(){this.setState({toggleHideChatPanel:!1})},addChatViewer:function(e,t){if(this.activateChatPanel(),-1===this.state.currentChats.indexOf(t)){var a="";this.state.users.map(function(e){e.in_UsuarioID==t&&(a=e.vc_Nombre+" "+e.vc_ApePaterno+" "+e.vc_ApeMaterno)}),this.setState({chatViewers:[React.createElement(ChatViewer,{id:t,key:t,onClick:this.sendMessage.bind(this),ref:e=>this.updateState(e,t),data:"rawData",messages:e,userName:a,onDropChatViewer:this.dropChatViewer})].concat(this.state.chatViewers),currentChats:this.state.currentChats.concat(t)})}},scrollSmoothToBottom:function(e){document.getElementById(e)},hideAdminPanel:function(){this.setState({toggleHide:!this.state.toggleHide})},toggleChatPanel:function(e){this.setState({toggleHideChatPanel:!this.state.toggleHideChatPanel})},render:function(){return React.createElement("div",{className:"chatMain"},React.createElement("div",{className:"hideAdminPanel",onClick:this.hideAdminPanel.bind(this)}," ",React.createElement("span",null," ",this.state.toggleHide?"OCULTAR":"MOSTRAR")," ",React.createElement("span",null,"PANEL")," "),React.createElement("div",{id:"divMiniPanel",onClick:this.toggleChatPanel.bind(this)},React.createElement("span",null,"miniPanel")," "),React.createElement("div",{id:"divChatPanel",ref:"myChatPanel",className:this.state.toggleHideChatPanel?"hiddden":""},this.state.chatViewers),this.state.haveAdminPanel?React.createElement("div",{id:"divAdminPanel",className:this.state.toggleHide?"hiddden":"",ref:"adminPanel"},React.createElement(UserList,{users:this.state.users,onClick:this.receiveUserAction,onHideAdminPanel:this.hideAdminPanel})):"")}});ReactDOM.render(React.createElement(ChatContainer,null),document.getElementById("divChatWrapper"))},{}]},{},[1]);